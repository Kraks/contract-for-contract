\newcommand{\Edenot}[1]{\mathsf{E}\llbracket{#1}\rrbracket}
\newcommand{\Sdenot}[1]{\mathsf{S}\llbracket{#1}\rrbracket}
\newcommand{\Fdenot}[1]{\mathsf{F}\llbracket{#1}\rrbracket}

\newcommand{\Unwrap}[1]{ \textit{unwrap}(#1) }
\newcommand{\Wrap}[1]{ \textit{wrap}(#1) }
\newcommand{\Attach}[1]{ \textit{attachSpec}(#1) }
\newcommand{\Dispatch}[3]{ \textit{dispatch}^{#1}_{#2}(#3) }

\newcommand{\rulesep}{\unskip\ \vrule\ }


\begin{figure*}[ht]
\begin{subfigure}[t]{0.40\textwidth}
  \judgement{Expression Translation}{$\Edenot{\cdot}$}
  \centering
  \small
  \begin{alignat*}{2}
    && \Edenot{x} & = x \\
    && \Edenot{v} & = \Wrap{v} \\
    && \Edenot{e_1 ~op~ e_2} & = \Unwrap{\Edenot{e_1}} ~op~ \Unwrap{\Edenot{e_2}} \\
    && \Edenot{f(e, \dots)} & = f_\textit{guard}(\Edenot{e}, \dots) \\
    && \Edenot{\kappa(e_\textit{addr})\Keywd{.}f(e, \dots)} & = \Dispatch{\kappa}{f}{\Edenot{e_\textit{addr}}, \Edenot{e}, \dots}
  \end{alignat*}
\end{subfigure}
\rulesep
\begin{subfigure}[t]{0.53\textwidth}
  \judgement{Statement Translation}{$\Sdenot{\cdot}$}
  \centering
  \small
  \begin{alignat*}{2}
    && \Sdenot{t ~ x} & = t^\uparrow ~ x  \hspace{6.25em} \Sdenot{e} = \Edenot{e} \\
    && \Sdenot{t ~ x ~\Keywd{=}~ e} & = t^\uparrow ~ x ~\Keywd{=}~ \Edenot{e}  \hspace{2em} \Sdenot{x ~\Keywd{=}~ e} = x ~\Keywd{=}~ \Edenot{e} \\
    && \Sdenot{s_1 \Keywd{;}~ s_2}  & = \Sdenot{s_1} \Keywd{;}~ \Sdenot{s_2} \\
    && \Sdenot{\Keywd{return}~ e}   & = \Keywd{return}~ \Edenot{e} \\
    %&& \Sdenot{\Keywd{revert}}      & = \Keywd{revert} \\
    && \Sdenot{\Keywd{if (}e\Keywd{) \{}~ s_1 ~\Keywd{\} else \{}~ s_2 ~\Keywd{\}}} & =
      \Keywd{if (}\Edenot{e}\Keywd{) \{}~ \Sdenot{s_1}~\Keywd{\} else \{}~ \Sdenot{s_2} ~\Keywd{\}}
  \end{alignat*}
  \end{subfigure}
  \caption{The translation semantics of $\lambda_\lang$ (statements and expressions).}
  \label{fig:translation}
\end{figure*}

\begin{figure}
  \judgement{Function Translation}{$\Fdenot{\cdot}$}
  \centering
  \small
  \begin{alignat*}{2}
    %& \Fdenot{ {\color{csspec} \SpecCall{f}{x_1, \dots}{y_1, \dots} \SpecCond{e_1}{e_2}{(\sigma_1, \dots)}} ~ \FunType{f}{t_1 ~ x_1, \dots}{\Keywd{public}}{r_1, \dots} ~ \Keywd{\{} ~ s ~ \Keywd{\}} } && = \\
    %    & \hspace{1em} \FunType{f}{t_1 ~ x_1, \dots}{\Keywd{public}}{r_1, \dots} ~ \Keywd{\{}~ \Keywd{return}~ \Unwrap{ f_\textit{guard}(\Wrap{x_1}, \dots) }  ~\Keywd{\}} && \\
    %    & \hspace{1em}  \Fdenot{ {\color{csspec} \SpecCall{f}{x_1, \dots}{y_1, \dots} \SpecCond{e_1}{e_2}{(\sigma_1, \dots)}} ~ \FunType{f}{t_1 ~ x_1, \dots}{\Keywd{private}}{r_1, \dots} ~ \Keywd{\{} ~ s ~ \Keywd{\}} } && \\
    & \mathsf{F}\llbracket {\color{csspec} \SpecCall{f}{x_1, \dots}{y_1, \dots} \SpecCond{e_1}{e_2}{(\sigma_1, \dots)}} && \\
    & \hspace{0.75em} \FunType{f}{t_1 ~ x_1, \dots}{m}{r_1, \dots} ~ \Keywd{\{} ~ s ~ \Keywd{\}} \rrbracket = && \\
        & \hspace{1.25em} \FunType{f}{t_1 ~ x_1, \dots}{m}{r_1, \dots} ~ \Keywd{\{}~ && \\
        & \hspace{2.25em} \Keywd{return}~ \Unwrap{ f_\textit{guard}(\Wrap{x_1}, \dots) }  ~\Keywd{\}} && \\
        & \hspace{1.25em}
          \FunType{f_{\textit{pre}}}{t_1^\uparrow ~ x_1, \dots}{\Keywd{private}}{} ~ \Keywd{\{} ~  \Keywd{require(} \Edenot{e_1} \Keywd{)} ~ \Keywd{\}} && \\
        & \hspace{1.25em}
          \FunType{f_{\textit{post}}}{t_1^\uparrow ~ x_1, \dots, r_1^\uparrow ~ y_1, \dots}{\Keywd{private}}{} ~ \Keywd{\{} ~ \Keywd{require(} \Edenot{e_1} \Keywd{)}  ~ \Keywd{\}} && \\
        & \hspace{1.25em}
          \FunType{f_{\textit{guard}}}{t_1^\uparrow ~ x_1, \dots}{\Keywd{private}}{r_1^\uparrow, \dots} ~ \Keywd{\{} && \\
        &   \hspace{2.25em} f_\textit{pre}(x_1, ...) && \\
        &   \hspace{2.25em} \Attach{x_1, ..., \sigma_1, \dots} && \\
        &   \hspace{2.25em} (r_1^\uparrow ~ y_1, ...) = f_\textit{worker}(x_1, \dots) && \\
        &   \hspace{2.25em} \Attach{y_1, ..., \sigma_1, \dots} && \\
        &   \hspace{2.25em} f_\textit{post}(x_1, \dots, y_1, \dots) && \\
        &   \hspace{2.25em} \Keywd{return}~ (y_1, \dots) ~ \Keywd{\}} && \\
        %&   \hspace{1.25em} \Keywd{\}}  && \\
        & \hspace{1.25em}
          \FunType{f_{\textit{worker}}}{t_1^\uparrow ~ x_1, \dots}{\Keywd{private}}{r_1^\uparrow, \dots} ~ \Keywd{\{} ~ \Sdenot{s} ~ \Keywd{\}}  &&
  \end{alignat*}
  % \vspace{-2em}
  \vspace{-2mm}
  \caption{The translation semantics of $\lambda_\lang$ (functions).}
  \label{fig:fun-translation}
\end{figure}
